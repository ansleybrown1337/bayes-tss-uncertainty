---
title: "tss-uncertainty"
author: "A.J. Brown"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Bayesian Inference for TSS Measurement Uncertainty
By A.J. Brown
Agricultural Data Scientist
ansleybrown1337@gmail.com
[Personal Website](https://sites.google.com/view/ansleyjbrown/)

Description: This script is used to perform Bayesian inference on TSS using
the NIMBLE package in R. For more information please view the README.md file
in the root directory of [this repository](https://github.com/ansleybrown1337/bayes-tss-uncertainty).


```{r}
# Set working directory to repo parent folder
setwd(dirname(getwd()))

# Load packages
package.list <- c(
  'BayesianTools',  
  'nimble',
  'coda',
  'ggplot2',
  'dplyr',
  'tidyr'
  )
packageLoad <- function(packages){
  for (i in packages) {
    if (!require(i, character.only = TRUE)) {
      install.packages(i)
      library(i, character.only = TRUE)
    }
  }
}
packageLoad(package.list)
```

```{r}
# Load data
tss_df <- read.csv('./Example Data/TSS_Master_2023.csv')
```

```{r}
# Process data
    # separate data into two dataframes: standards and real data
std_list <- c('Stock Solution', 'DI')
std_df <- tss_df %>% filter(Sample_ID %in% std_list)
real_df <- tss_df %>% filter(!Sample_ID %in% std_list)

    # calculate error column for standards
std_df <- std_df %>% mutate(
  tss.err = ifelse(Sample_ID == 'Stock Solution', 100-TSS_mg.L, 0-TSS_mg.L)
  )
```

# Defining our model
We will use simple linear regression to estimate measurement error. I will
assume the following form:

$$
